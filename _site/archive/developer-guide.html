<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Developer Guide | CheckIT-Core Documentation</title>
  <link rel="stylesheet" href="/CheckIT-Documentation/assets/style.css">
</head>
<body>
  <div class="site-container">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="/CheckIT-Documentation/">CheckIT-Core</a>
        <nav class="site-nav">
          <div class="nav-row">
            
              <a href="/CheckIT-Documentation/docs/README" class="page-link">‚ÑπÔ∏è About</a>
            
              <a href="/CheckIT-Documentation/docs/get-started" class="page-link">üöÄ Get Started</a>
            
              <a href="/CheckIT-Documentation/docs/api-reference" class="page-link">üìò API Reference</a>
            
              <a href="/CheckIT-Documentation/docs/quick-reference" class="page-link">‚ö° Quick Reference</a>
            
              <a href="/CheckIT-Documentation/docs/templateInfo" class="page-link">üß© Template System</a>
            
          </div>
          <div class="nav-row">
            
              <a href="/CheckIT-Documentation/docs/troubleshooting" class="page-link">üîç Troubleshooting</a>
            
              <a href="/CheckIT-Documentation/docs/internal-helpers" class="page-link">üîß Internal Helper Functions</a>
            
              <a href="/CheckIT-Documentation/CHANGELOG" class="page-link">üìã Changelog</a>
            
          </div>
        </nav>
      </div>
    </header>

    <main class="page-content">
      <div class="wrapper">
        <link rel="stylesheet" href="../assets/style.css" />

<h1 id="checkit-developer-guide">CheckIT Developer Guide</h1>

<blockquote>
  <p>Comprehensive development patterns, rules, and workflows for CheckIT-Core</p>
</blockquote>

<h2 id="-the-big-3-patterns-master-these-first">üéØ The Big 3 Patterns (Master These First)</h2>

<h3 id="1-reporting-pattern-separate-task-logging-from-business-reporting">1. Reporting Pattern: Separate Task Logging from Business Reporting</h3>

<p><strong>The Problem:</strong> Mixing task logging with business reporting causes double entries and -Task parameter errors.</p>

<p><strong>The Solution:</strong> Always separate these concerns:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Two separate calls:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Write-TaskLog</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="nv">$function</span><span class="w"> </span><span class="nt">-TaskParams</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="nx">Mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Mode</span><span class="w">
    </span><span class="nx">Filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Filter</span><span class="w">
    </span><span class="c"># Note: NO "Report = $true" - prevents automatic Set-Report call</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="c"># Determine groups for business report</span><span class="w">
</span><span class="nv">$groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Group</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="nv">$uniqueGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$groups</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Unique</span><span class="w">
</span><span class="nv">$reportGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$uniqueGroups</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="s1">'Assorted'</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$uniqueGroups</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="nv">$uniqueGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@()</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># Business report (separate, clean data) - NO -Task parameter</span><span class="w">
</span><span class="n">Set-Report</span><span class="w"> </span><span class="nt">-ReportName</span><span class="w"> </span><span class="nv">$ReportName</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Function</span><span class="w"> </span><span class="nv">$function</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Data</span><span class="w"> </span><span class="nv">$cleanResults</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Groups</span><span class="w"> </span><span class="nv">$reportGroups</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Errors</span><span class="w"> </span><span class="nv">$nodeErrors</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Creates double reporting errors:</span><span class="w">
</span><span class="n">Set-Report</span><span class="w"> </span><span class="nt">-Task</span><span class="w"> </span><span class="nt">-TaskParams</span><span class="w"> </span><span class="p">@{</span><span class="err">...</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-enhanced-confirmation-pattern-automation-friendly-user-interaction">2. Enhanced Confirmation Pattern: Automation-Friendly User Interaction</h3>

<p><strong>The Problem:</strong> Functions either block automation or don‚Äôt provide user control.</p>

<p><strong>The Solution:</strong> Three-tier confirmation system with session memory:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Enhanced confirmation parameter:</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">My-CheckITFunction</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">object</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">,</span><span class="w">  </span><span class="c"># $true, $false, or "Auto"</span><span class="w">
        </span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
    </span><span class="p">)</span><span class="w">
    
    </span><span class="c"># Implementation pattern:</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">  </span><span class="c"># Skip confirmation entirely</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Auto"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># Check session-wide preferences, prompt once and remember</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Enhanced options: Y/N/YA/NA for session control</span><span class="w">
            </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Proceed? (Y/N/YA=Yes to All/NA=No to All)"</span><span class="w">
            </span><span class="c"># Store choice for session-wide automation</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># Traditional confirmation with session-wide awareness</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Proceed? (Y/N)"</span><span class="w">
            </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(y|yes)$'</span><span class="p">)</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG - No automation support:</span><span class="w">
</span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Continue? (Y/N)"</span><span class="w">  </span><span class="c"># Blocks automation</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-credential-pattern-automatic-credential-management">3. Credential Pattern: Automatic Credential Management</h3>

<p><strong>The Problem:</strong> Manual credential handling blocks GUI and doesn‚Äôt integrate with Passman.</p>

<p><strong>The Solution:</strong> Use Process-Parallel -UseCredentials for automatic handling:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Automatic credential handling:</span><span class="w">
</span><span class="nv">$parallelResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Process-Parallel</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="p">{</span><span class="w"> 
    </span><span class="kr">param</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span><span class="w"> </span><span class="nv">$customParam1</span><span class="p">,</span><span class="w"> </span><span class="nv">$customParam2</span><span class="p">,</span><span class="w"> </span><span class="nv">$credential</span><span class="p">,</span><span class="w"> </span><span class="nv">$fqdn</span><span class="p">)</span><span class="w">
    </span><span class="c"># $credential and $fqdn automatically available here</span><span class="w">
    </span><span class="n">Invoke-Command</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="nv">$fqdn</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$credential</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="p">{</span><span class="w"> 
        </span><span class="c"># Your remote operations here</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="nt">-ArgumentList</span><span class="w"> </span><span class="p">@(</span><span class="nv">$customParam1</span><span class="p">,</span><span class="w"> </span><span class="nv">$customParam2</span><span class="p">)</span><span class="w"> </span><span class="nt">-UseCredentials</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Manual credential handling:</span><span class="w">
</span><span class="nv">$cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Credential</span><span class="w">  </span><span class="c"># Blocks GUI, no Passman integration</span><span class="w">
</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$nodes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Invoke-Command</span><span class="w"> </span><span class="nt">-ComputerName</span><span class="w"> </span><span class="nv">$node</span><span class="w"> </span><span class="nt">-Credential</span><span class="w"> </span><span class="nv">$cred</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-template-driven-development-philosophy">üîÑ Template-Driven Development Philosophy</h2>

<h3 id="core-principle-templates-first-functions-second">Core Principle: Templates First, Functions Second</h3>

<p><strong>Always check existing capabilities before building new ones:</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT: Template-driven approach</span><span class="w">
</span><span class="c"># 1. Search existing templates</span><span class="w">
</span><span class="n">Manage-Templates</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">List</span><span class="w">
</span><span class="n">Manage-Templates</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">Codebase</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Search</span><span class="w">

</span><span class="c"># 2. Use template workflows for complex operations</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"Get OS Info"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Check Disk Space"</span><span class="p">)</span><span class="w"> </span><span class="nt">-WorkflowName</span><span class="w"> </span><span class="s2">"System_Audit"</span><span class="w"> </span><span class="nt">-ExportToExcel</span><span class="w">

</span><span class="c"># 3. Only create new functions when templates can't solve the need</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="template-workflow-integration-pattern">Template Workflow Integration Pattern</h3>

<p><strong>How enhanced workflows inherit confirmation settings:</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT: Workflow confirmation inheritance</span><span class="w">
</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$templateName</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$Templates</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$isCommandTemplate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># Inherit workflow confirmation settings to prevent double-prompting</span><span class="w">
        </span><span class="nv">$templateConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$false</span><span class="w"> </span><span class="o">-or</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> 
            </span><span class="bp">$false</span><span class="w">  </span><span class="c"># Inherit automation setting</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> 
            </span><span class="bp">$true</span><span class="w">   </span><span class="c"># Use standard confirmation</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="nv">$templateName</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="nv">$templateConfirm</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># User selects "Yes to All" at workflow level ‚Üí individual templates auto-execute</span><span class="w">
</span><span class="c"># No double-prompting, seamless automation</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="excel-integration-strategy">Excel Integration Strategy</h3>

<p><strong>How workflows create comprehensive reports:</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT: Use actual report data, not intermediate batching</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$ExportToExcel</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$executedTemplates</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$sheets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">
    
    </span><span class="c"># Individual template sheets from actual reports</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$templateName</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$executedTemplates</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$cleanSheetName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$templateName</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'[^A-Za-z0-9_\-]'</span><span class="p">,</span><span class="w"> </span><span class="s1">'_'</span><span class="w">
        </span><span class="nv">$sheets</span><span class="p">[</span><span class="nv">$cleanSheetName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$workflowResults</span><span class="p">[</span><span class="nv">$templateName</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># Summary sheet with all results combined</span><span class="w">
    </span><span class="nv">$sheets</span><span class="p">[</span><span class="s2">"Summary"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allResults</span><span class="w">
    </span><span class="n">Export-ToExcel</span><span class="w"> </span><span class="nt">-Sheets</span><span class="w"> </span><span class="nv">$sheets</span><span class="w"> </span><span class="nt">-Title</span><span class="w"> </span><span class="nv">$WorkflowName</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Artificial batching/combining</span><span class="w">
</span><span class="n">Build-Report</span><span class="w"> </span><span class="nt">-Batch</span><span class="w"> </span><span class="nv">$WorkflowName</span><span class="w"> </span><span class="nt">-Result</span><span class="w"> </span><span class="nv">$result</span><span class="w">  </span><span class="c"># Don't do this</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-critical-rules--syntax">üö® Critical Rules &amp; Syntax</h2>

<h3 id="module-structure-rules">Module Structure Rules</h3>

<h4 id="function-export-requirements">Function Export Requirements</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Add ALL implemented functions:</span><span class="w">
</span><span class="n">Export-ModuleMember</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="s1">'Get-Software'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Get-CCMPackages'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Test-NodeConnection'</span><span class="p">,</span><span class="w">
    </span><span class="s1">'Invoke-TemplateWorkflow'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Invoke-TemplateCommand'</span><span class="p">,</span><span class="w">  </span><span class="c"># Template functions</span><span class="w">
    </span><span class="s1">'Your-New-Function'</span><span class="w">  </span><span class="c"># Always add new functions here</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Missing from exports:</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Your-New-Function</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="c"># No corresponding entry in Export-ModuleMember = function won't be available</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="module-load-order">Module Load Order</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - At end of module:</span><span class="w">
</span><span class="n">Export-ModuleMember</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="p">@(</span><span class="w">
    </span><span class="s1">'Function1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Function2'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Function3'</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c"># Initialize globals AFTER exports (LAST lines of module)</span><span class="w">
</span><span class="n">Ensure-CheckITGlobals</span><span class="w">
</span><span class="nx">Ensure-Templates</span><span class="w">  </span><span class="c"># NEW: Load all built-in templates</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Globals before exports:</span><span class="w">
</span><span class="n">Ensure-CheckITGlobals</span><span class="w">
</span><span class="nx">Export-ModuleMember</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="p">@(</span><span class="s1">'Function1'</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="enhanced-confirmation-implementation-rules">Enhanced Confirmation Implementation Rules</h3>

<h4 id="parameter-declaration-pattern">Parameter Declaration Pattern</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Enhanced confirmation parameter:</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">My-CheckITFunction</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">array</span><span class="p">]</span><span class="nv">$Nodes</span><span class="p">,</span><span class="w">
        </span><span class="p">[</span><span class="n">object</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">,</span><span class="w">  </span><span class="c"># $true, $false, or "Auto"</span><span class="w">
        </span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
    </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Boolean only:</span><span class="w">
</span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">  </span><span class="c"># Limits automation flexibility</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="session-state-management">Session State Management</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Check and update session state:</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Check for existing session-wide choice</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG - No session awareness:</span><span class="w">
</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Proceed? (Y/N)"</span><span class="w">  </span><span class="c"># Asks every time, no automation</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="data-handling-rules">Data Handling Rules</h3>

<h4 id="string-interpolation">String Interpolation</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Always use $($variable):</span><span class="w">
</span><span class="s2">"Processing node: </span><span class="si">$(</span><span class="nv">$node</span><span class="o">.</span><span class="nf">Name</span><span class="si">)</span><span class="s2"> in group: </span><span class="si">$(</span><span class="nv">$node</span><span class="o">.</span><span class="nf">Group</span><span class="si">)</span><span class="s2">"</span><span class="w">
</span><span class="s2">"Status: </span><span class="si">$(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">Status</span><span class="si">)</span><span class="s2"> at </span><span class="si">$(</span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s1">'HH:mm:ss'</span><span class="p">)</span><span class="si">)</span><span class="s2">"</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Direct variable reference:</span><span class="w">
</span><span class="s2">"Processing node: </span><span class="nv">$node</span><span class="s2">.Name in group: </span><span class="nv">$node</span><span class="s2">.Group"</span><span class="w">
</span><span class="s2">"Status: </span><span class="nv">$result</span><span class="s2">.Status at </span><span class="si">$(</span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="s1">'HH:mm:ss'</span><span class="p">)</span><span class="s2">"
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="datetime-formatting">DateTime Formatting</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use .ToString() method:</span><span class="w">
</span><span class="nv">$timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-dd HH:mm:ss"</span><span class="p">)</span><span class="w">
</span><span class="nv">$dateStamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s2">"yyyy-MM-dd"</span><span class="p">)</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Get-Date -Format:</span><span class="w">
</span><span class="nv">$timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-Format</span><span class="w"> </span><span class="s2">"yyyy-MM-dd HH:mm:ss"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="null-comparisons">Null Comparisons</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Null on left:</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$variable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="nv">$result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Variable on left:</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$variable</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="o">-ne</span><span class="w"> </span><span class="bp">$null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="array-safety">Array Safety</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Ensure array output:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="err">SomeFunction</span><span class="p">)</span><span class="w">
</span><span class="nv">$nodeNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="nv">$nodes</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="p">})</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Unsafe array assumptions:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunction</span><span class="w">
</span><span class="nv">$results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">  </span><span class="c"># May fail if $results is null or single object</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="node-management-rules">Node Management Rules</h3>

<h4 id="global-variables">Global Variables</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use NodeList function:</span><span class="w">
</span><span class="n">NodeList</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$newNodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">
</span><span class="n">NodeList</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="p">@(</span><span class="nv">$updatedNode</span><span class="p">)</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Direct manipulation:</span><span class="w">
</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$newNode</span><span class="w">
</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"PC123"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Complete"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="node-updates">Node Updates</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use New-NodeObject (preserves Passman status):</span><span class="w">
</span><span class="nv">$updatedNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="p">@{</span><span class="w"> </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PC123"</span><span class="p">;</span><span class="w"> </span><span class="nx">Group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LabA"</span><span class="p">;</span><span class="w"> </span><span class="nx">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Complete"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">NodeList</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="p">@(</span><span class="nv">$updatedNode</span><span class="p">)</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Direct property assignment:</span><span class="w">
</span><span class="nv">$node</span><span class="o">.</span><span class="nf">Passman</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">  </span><span class="c"># Loses existing Passman status</span><span class="w">
</span><span class="nv">$node</span><span class="o">.</span><span class="nf">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Complete"</span><span class="w">  </span><span class="c"># Not normalized</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="case-sensitivity">Case Sensitivity</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Case-insensitive comparisons:</span><span class="w">
</span><span class="nv">$existingNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">()</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$targetNode</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Case-sensitive comparison:</span><span class="w">
</span><span class="nv">$existingNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$targetNode</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="gui-compatibility-rules">GUI Compatibility Rules</h3>

<h4 id="json-import">JSON Import</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use -AsHashtable for GUI compatibility:</span><span class="w">
</span><span class="nv">$data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"file.json"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w"> </span><span class="nt">-AsHashtable</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Default JSON import:</span><span class="w">
</span><span class="nv">$data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Content</span><span class="w"> </span><span class="s2">"file.json"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertFrom-Json</span><span class="w">  </span><span class="c"># Creates PSCustomObject, not hashtable</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="progress-reporting">Progress Reporting</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - No duplicate parameters:</span><span class="w">
</span><span class="n">Write-Progress</span><span class="w"> </span><span class="nt">-Activity</span><span class="w"> </span><span class="s2">"Processing"</span><span class="w"> </span><span class="nt">-Status</span><span class="w"> </span><span class="s2">"Working..."</span><span class="w"> </span><span class="nt">-PercentComplete</span><span class="w"> </span><span class="nx">50</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Duplicate parameters:</span><span class="w">
</span><span class="n">Write-Progress</span><span class="w"> </span><span class="nt">-Activity</span><span class="w"> </span><span class="s2">"Processing"</span><span class="w"> </span><span class="nt">-Status</span><span class="w"> </span><span class="s2">"Working..."</span><span class="w"> </span><span class="nt">-Status</span><span class="w"> </span><span class="s2">"Different status..."</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="cli-vs-gui-calls">CLI vs GUI Calls</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - GUI-safe function calls:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Software</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">
</span><span class="n">NodeList</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$newNodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Blocks GUI:</span><span class="w">
</span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter value"</span><span class="w">  </span><span class="c"># Use: if ($PromptUser) { Read-Host "Enter value" }</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="code-quality-rules">Code Quality Rules</h3>

<h4 id="line-continuation">Line Continuation</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Single line or parameter splatting:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunction</span><span class="w"> </span><span class="nt">-Parameter1</span><span class="w"> </span><span class="nv">$value1</span><span class="w"> </span><span class="nt">-Parameter2</span><span class="w"> </span><span class="nv">$value2</span><span class="w"> </span><span class="nt">-Parameter3</span><span class="w"> </span><span class="nv">$value3</span><span class="w">

</span><span class="c"># ‚úÖ CORRECT - Parameter splatting for complex calls:</span><span class="w">
</span><span class="nv">$params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="nx">Parameter1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$value1</span><span class="w">
    </span><span class="nx">Parameter2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$value2</span><span class="w">
    </span><span class="nx">Parameter3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$value3</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunction</span><span class="w"> </span><span class="err">@</span><span class="nx">params</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Fragile backtick continuation:</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeFunction</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Parameter1</span><span class="w"> </span><span class="nv">$value1</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Parameter2</span><span class="w"> </span><span class="nv">$value2</span><span class="w"> </span><span class="se">` </span><span class="w"> </span><span class="c"># Breaks with trailing whitespace</span><span class="w">
    </span><span class="nt">-Parameter3</span><span class="w"> </span><span class="nv">$value3</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="automatic-variables">Automatic Variables</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use custom variables:</span><span class="w">
</span><span class="nv">$customError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Custom error message"</span><span class="w">
</span><span class="nv">$userInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Enter value"</span><span class="w">
</span><span class="nv">$matchResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$text</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="nv">$pattern</span><span class="w">

</span><span class="c"># ‚ùå WRONG - Using PowerShell automatic variables:</span><span class="w">
</span><span class="nv">$error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Custom error"</span><span class="w">      </span><span class="c"># Use $customError</span><span class="w">
</span><span class="bp">$input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"User input"</span><span class="w">        </span><span class="c"># Use $userInput  </span><span class="w">
</span><span class="nv">$matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$customMatches</span><span class="w">    </span><span class="c"># Use $matchResults</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="excel-dependencies">Excel Dependencies</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT - Use CheckIT built-in:</span><span class="w">
</span><span class="n">Export-ToExcel</span><span class="w"> </span><span class="nt">-Sheets</span><span class="w"> </span><span class="nv">$data</span><span class="w"> </span><span class="nt">-Title</span><span class="w"> </span><span class="s2">"Report"</span><span class="w">

</span><span class="c"># ‚ùå WRONG - External module dependency:</span><span class="w">
</span><span class="n">Export-Excel</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$file</span><span class="w">  </span><span class="c"># Requires ImportExcel module</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="Ô∏è-enhanced-development-workflow">üõ†Ô∏è Enhanced Development Workflow</h2>

<h3 id="step-1-template-driven-analysis">Step 1: Template-Driven Analysis</h3>

<p><strong>Before writing ANY new function:</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c"># 1. Check existing command templates</span><span class="w">
</span><span class="n">Manage-Templates</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">List</span><span class="w">

</span><span class="c"># 2. Search for development patterns</span><span class="w">
</span><span class="n">Manage-Templates</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">Codebase</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Search</span><span class="w">

</span><span class="c"># 3. Test existing workflow capabilities</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"Get OS Info"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Check Disk Space"</span><span class="p">)</span><span class="w"> </span><span class="nt">-WorkflowName</span><span class="w"> </span><span class="s2">"Test"</span><span class="w"> </span><span class="nt">-ExportToExcel</span><span class="w">

</span><span class="c"># 4. Only proceed if templates can't solve the requirement</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-get-the-complete-function-template">Step 2: Get the Complete Function Template</h3>

<p><strong>Always start with the proven template:</strong></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># Get the complete function template</span><span class="w">
</span><span class="n">Manage-Templates</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">Codebase</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Preview</span><span class="w">
</span><span class="c"># Select "CheckIT Function Template"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>This template provides:</strong></p>
<ul>
  <li>Enhanced confirmation pattern implementation</li>
  <li>Process-Parallel integration with -UseCredentials</li>
  <li>Correct reporting pattern (separate task logging and business reporting)</li>
  <li>Error handling and status updates</li>
  <li>CLI/GUI compatibility</li>
  <li>All required CheckIT patterns</li>
</ul>

<h3 id="step-3-enhanced-function-structure-template">Step 3: Enhanced Function Structure Template</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
</pre></td><td class="rouge-code"><pre><span class="kr">function</span><span class="w"> </span><span class="nf">New-CheckITFunction</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="cm">&lt;#
    </span><span class="cs">.SYNOPSIS</span><span class="cm">
        Brief one-line description of what the function does.
    </span><span class="cs">.DESCRIPTION</span><span class="cm">
        Detailed explanation including:
        - What it accomplishes
        - How it integrates with CheckIT patterns
        - CLI vs GUI compatibility notes
        - Enhanced confirmation behavior
    </span><span class="cs">.PARAMETER</span><span class="cm"> Nodes
        Array of node objects or names
    </span><span class="cs">.PARAMETER</span><span class="cm"> Confirm
        Controls execution confirmation:
        - $true (default): Prompts for confirmation before execution
        - $false: Executes immediately without confirmation
        - "Auto": Uses session-wide confirmation preferences
    </span><span class="cs">.PARAMETER</span><span class="cm"> PromptUser
        CLI vs GUI mode control
    </span><span class="cs">.PARAMETER</span><span class="cm"> StatusCallback
        GUI progress reporting
    </span><span class="cs">.EXAMPLE</span><span class="cm">
        # CLI usage with standard confirmation
        New-CheckITFunction -Nodes $nodes -PromptUser:$true
    </span><span class="cs">.EXAMPLE</span><span class="cm">  
        # Automation usage
        New-CheckITFunction -Nodes $nodes -Confirm:$false -PromptUser:$false
    </span><span class="cs">.EXAMPLE</span><span class="cm">
        # Smart session automation
        New-CheckITFunction -Nodes $nodes -Confirm "Auto"
    #&gt;</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="p">)]</span><span class="w">
        </span><span class="p">[</span><span class="n">object</span><span class="p">[]]</span><span class="nv">$Nodes</span><span class="p">,</span><span class="w">
        </span><span class="p">[</span><span class="n">object</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">,</span><span class="w">  </span><span class="c"># Enhanced confirmation pattern</span><span class="w">
        </span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">,</span><span class="w">
        </span><span class="p">[</span><span class="n">scriptblock</span><span class="p">]</span><span class="nv">$StatusCallback</span><span class="w">
    </span><span class="p">)</span><span class="w">

    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="c"># INITIALIZATION &amp; VALIDATION PHASE</span><span class="w">
    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="nv">$user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">USERNAME</span><span class="w">
    </span><span class="nv">$timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w">
    </span><span class="nv">$function</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"New-CheckITFunction"</span><span class="w">
    
    </span><span class="c"># 1. ‚úÖ ALWAYS: Ensure credentials</span><span class="w">
    </span><span class="n">Ensure-GlobalCredStore</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="nv">$PromptUser</span><span class="w">
    
    </span><span class="c"># 2. ‚úÖ ALWAYS: Normalize nodes using standard pattern</span><span class="w">
    </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$Nodes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="o">-is</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="nv">$node</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="nv">$node</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeObjects</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$PromptUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"No valid nodes provided."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Red</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="kr">return</span><span class="w"> </span><span class="p">@()</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="c"># ENHANCED CONFIRMATION PATTERN IMPLEMENTATION</span><span class="w">
    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$PromptUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"</span><span class="se">`n</span><span class="s2">=== FUNCTION EXECUTION: </span><span class="si">$(</span><span class="nv">$function</span><span class="si">)</span><span class="s2"> ==="</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Green</span><span class="w">
        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Target Nodes: </span><span class="si">$(</span><span class="nv">$nodeObjects</span><span class="o">.</span><span class="nf">Count</span><span class="si">)</span><span class="s2">"</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">White</span><span class="w">
        
        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">
        
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
            </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-executing (confirmation disabled)..."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"Auto"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Check for session-wide workflow preferences</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">
            </span><span class="p">}</span><span class="w">
            
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
                </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$shouldProceed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-proceeding (session-wide Yes to All)..."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
                </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-cancelled (session-wide No to All)."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
                    </span><span class="kr">return</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="c"># Standard confirmation for Auto mode</span><span class="w">
                </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"</span><span class="se">`n</span><span class="s2">Proceed with execution? (Y/N/YA=Yes to All/NA=No to All)"</span><span class="w">
                
                </span><span class="kr">switch</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(Y|YES)$'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w"> </span><span class="p">}</span><span class="w">
                    </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(YA|YESALL|YES.*ALL)$'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
                        </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
                        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Will auto-proceed with all functions for this session."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Green</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                    </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(NA|NOALL|NO.*ALL)$'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">
                        </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">
                        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Will auto-cancel all functions for this session."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                    </span><span class="n">default</span><span class="w"> </span><span class="p">{</span><span class="w">
                        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
        </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Traditional confirmation with session-wide awareness</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
                </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$shouldProceed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-proceeding (session-wide Yes to All)..."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
                </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-cancelled (session-wide No to All)."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
                    </span><span class="kr">return</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"</span><span class="se">`n</span><span class="s2">Proceed with execution? (Y/N)"</span><span class="w">
                </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(y|yes)$'</span><span class="p">)</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
        
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="nv">$shouldProceed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Function execution cancelled."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
            </span><span class="kr">return</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c"># GUI mode: respect Confirm parameter directly</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="bp">$false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Proceed without confirmation</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># For GUI, assume confirmation handled by calling code</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># 3. ‚úÖ ALWAYS: Set TaskStatus for progress tracking</span><span class="w">
    </span><span class="nv">$nodeNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeNames</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="nv">$node</span><span class="o">.</span><span class="nf">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$node</span><span class="o">.</span><span class="nf">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Processing"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="c"># MAIN PROCESSING PHASE</span><span class="w">
    </span><span class="c"># ====================================================================</span><span class="w">
    
    </span><span class="c"># 4. ‚úÖ YOUR PROCESS-PARALLEL SCRIPTBLOCK</span><span class="w">
    </span><span class="nv">$yourScriptBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">param</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span><span class="w"> </span><span class="nv">$customParam1</span><span class="p">,</span><span class="w"> </span><span class="nv">$customParam2</span><span class="p">,</span><span class="w"> </span><span class="nv">$credential</span><span class="p">,</span><span class="w"> </span><span class="nv">$fqdn</span><span class="p">)</span><span class="w">
        
        </span><span class="nv">$startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w">
        </span><span class="nv">$nodeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="o">-is</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$node</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nv">$node</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="p">}</span><span class="w">
        
        </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c"># Your core logic here</span><span class="w">
            </span><span class="c"># $credential and $fqdn are automatically available</span><span class="w">
            
            </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
                </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeName</span><span class="w">
                </span><span class="c"># Your result properties</span><span class="w">
                </span><span class="nx">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Success"</span><span class="w">
                </span><span class="nx">StartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$startTime</span><span class="w">
                </span><span class="nx">EndTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Get</span><span class="err">-</span><span class="nx">Date</span><span class="w">
            </span><span class="p">}</span><span class="w">
            
            </span><span class="kr">return</span><span class="w"> </span><span class="nv">$result</span><span class="w">
            
        </span><span class="p">}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="kr">return</span><span class="w"> </span><span class="p">[</span><span class="n">PSCustomObject</span><span class="p">]@{</span><span class="w">
                </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeName</span><span class="w">
                </span><span class="nx">Status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Failed"</span><span class="w">
                </span><span class="nx">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="err">.</span><span class="nx">Exception</span><span class="err">.</span><span class="nx">Message</span><span class="w">
                </span><span class="nx">StartTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$startTime</span><span class="w">
                </span><span class="nx">EndTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Get</span><span class="err">-</span><span class="nx">Date</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># 5. ‚úÖ ALWAYS: Use Process-Parallel with -UseCredentials</span><span class="w">
    </span><span class="nv">$parallelResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Process-Parallel</span><span class="w"> </span><span class="nt">-ScriptBlock</span><span class="w"> </span><span class="nv">$yourScriptBlock</span><span class="w"> </span><span class="nt">-ArgumentList</span><span class="w"> </span><span class="p">@(</span><span class="nv">$param1</span><span class="p">,</span><span class="w"> </span><span class="nv">$param2</span><span class="p">)</span><span class="w"> </span><span class="nt">-MaxParallel</span><span class="w"> </span><span class="nx">8</span><span class="w"> </span><span class="nt">-StatusCallback</span><span class="w"> </span><span class="nv">$StatusCallback</span><span class="w"> </span><span class="nt">-UseCredentials</span><span class="w">
    
    </span><span class="c"># ====================================================================</span><span class="w">
    </span><span class="c"># RESULTS &amp; CLEANUP PHASE</span><span class="w">
    </span><span class="c"># ====================================================================</span><span class="w">
    
    </span><span class="c"># 6. ‚úÖ ALWAYS: Process results and separate errors</span><span class="w">
    </span><span class="nv">$allResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
    </span><span class="nv">$nodeErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
    
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$parallelResults</span><span class="o">.</span><span class="nf">Results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">PSObject</span><span class="o">.</span><span class="n">Properties</span><span class="p">[</span><span class="s1">'Node'</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="o">.</span><span class="nf">PSObject</span><span class="o">.</span><span class="n">Properties</span><span class="p">[</span><span class="s1">'Error'</span><span class="p">]</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">Error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$nodeErrors</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">New-ErrorRecord</span><span class="w"> </span><span class="nt">-Node</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="nt">-Error</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">Error</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="nv">$function</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nv">$allResults</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$result</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># 7. ‚úÖ ALWAYS: Update NodeList status</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeObj</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$nodeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObj</span><span class="o">.</span><span class="nf">Node</span><span class="w">
        </span><span class="nv">$nodeResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$allResults</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$nodeName</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="nv">$nodeError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeErrors</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Node</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$nodeName</span><span class="w"> </span><span class="p">}</span><span class="w">
        
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$updateObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="p">@{</span><span class="w"> </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeName</span><span class="p">;</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Error'</span><span class="p">;</span><span class="w"> </span><span class="nx">LastError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeError</span><span class="err">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeResults</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$updateObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="p">@{</span><span class="w"> </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeName</span><span class="p">;</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Complete'</span><span class="p">;</span><span class="w"> </span><span class="nx">LastError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$updateObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-NodeObject</span><span class="w"> </span><span class="p">@{</span><span class="w"> </span><span class="nx">Node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeName</span><span class="p">;</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'No Data'</span><span class="p">;</span><span class="w"> </span><span class="nx">LastError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
        
        </span><span class="n">NodeList</span><span class="w"> </span><span class="nt">-Action</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="p">@(</span><span class="nv">$updateObj</span><span class="p">)</span><span class="w"> </span><span class="nt">-CreateIfMissing</span><span class="p">:</span><span class="bp">$false</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># 8. ‚úÖ ALWAYS: Clear TaskStatus when done</span><span class="w">
    </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$node</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$nodeNames</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="nv">$node</span><span class="o">.</span><span class="nf">Node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$node</span><span class="o">.</span><span class="nf">TaskStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># 9. ‚úÖ CRITICAL: SEPARATE Task Logging and Business Reporting</span><span class="w">
    
    </span><span class="c"># Task logging (audit trail) - NO automatic Set-Report</span><span class="w">
    </span><span class="nv">$allResults</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Write-TaskLog</span><span class="w"> </span><span class="nt">-Function</span><span class="w"> </span><span class="nv">$function</span><span class="w"> </span><span class="nt">-TaskParams</span><span class="w"> </span><span class="p">@{</span><span class="w"> 
        </span><span class="c"># Your task parameters here</span><span class="w">
        </span><span class="c"># Note: NO "Report = $true" - prevents automatic Set-Report call</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
    
    </span><span class="c"># Determine groups for business report</span><span class="w">
    </span><span class="nv">$groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$nodeObjects</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Group</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="nv">$uniqueGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$groups</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nt">-Unique</span><span class="w">
    </span><span class="nv">$reportGroups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$uniqueGroups</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="s1">'Assorted'</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$uniqueGroups</span><span class="o">.</span><span class="nf">Count</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@(</span><span class="nv">$uniqueGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">@()</span><span class="w"> </span><span class="p">}</span><span class="w">
    
    </span><span class="c"># Business report (separate, clean data) - NO -Task parameter</span><span class="w">
    </span><span class="n">Set-Report</span><span class="w"> </span><span class="nt">-ReportName</span><span class="w"> </span><span class="nv">$ReportName</span><span class="w"> </span><span class="se">`
</span><span class="w">        </span><span class="nt">-Function</span><span class="w"> </span><span class="nv">$function</span><span class="w"> </span><span class="se">`
</span><span class="w">        </span><span class="nt">-Data</span><span class="w"> </span><span class="nv">$allResults</span><span class="w"> </span><span class="se">`
</span><span class="w">        </span><span class="nt">-Groups</span><span class="w"> </span><span class="nv">$reportGroups</span><span class="w"> </span><span class="se">`
</span><span class="w">        </span><span class="nt">-Errors</span><span class="w"> </span><span class="nv">$nodeErrors</span><span class="w"> </span><span class="se">`
</span><span class="w">        </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
    
    </span><span class="c"># 10. ‚úÖ Return results</span><span class="w">
    </span><span class="kr">return</span><span class="w"> </span><span class="nv">$allResults</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-4-enhanced-testing-checklist">Step 4: Enhanced Testing Checklist</h3>

<p><strong>Before submitting your function:</strong></p>

<h4 id="template-system-integration">Template System Integration</h4>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Manage-Templates -Type Codebase
</pre></td></tr></tbody></table></code> for complete function template</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Check if existing templates can solve the requirement first</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Consider if the function should be a template instead of a full function</li>
</ul>

<h4 id="enhanced-confirmation-implementation">Enhanced Confirmation Implementation</h4>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Implement three-tier confirmation: <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$true
</pre></td></tr></tbody></table></code>, <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$false
</pre></td></tr></tbody></table></code>, <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>"Auto"
</pre></td></tr></tbody></table></code></li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$global:WorkflowAutoConfirm
</pre></td></tr></tbody></table></code> for session-wide automation</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test all confirmation modes: standard, auto-execute, and smart automation</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify inheritance from workflow functions (no double-prompting)</li>
</ul>

<h4 id="core-checkit-patterns">Core CheckIT Patterns</h4>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Process-Parallel -UseCredentials
</pre></td></tr></tbody></table></code> (handles ALL credential magic automatically)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Separate task logging from business reporting (see Big 3 patterns)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>New-NodeObject
</pre></td></tr></tbody></table></code> for node updates (preserves Passman status)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test both CLI (<code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>-PromptUser:$true
</pre></td></tr></tbody></table></code>) and GUI (<code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>-PromptUser:$false
</pre></td></tr></tbody></table></code>)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Add StatusCallback parameter for GUI progress reporting</li>
</ul>

<h4 id="integration-testing">Integration Testing</h4>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test standalone function execution</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test integration with template workflows</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test session-wide automation (YA/NA options)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Verify Excel export compatibility</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Test error handling and NodeList updates</li>
</ul>

<h4 id="module-integration">Module Integration</h4>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Export functions in Export-ModuleMember when complete</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Update Ensure-Templates if adding built-in templates</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Update implementation status documentation</li>
</ul>

<h3 id="step-5-testing-procedures">Step 5: Testing Procedures</h3>

<h4 id="cli-testing">CLI Testing</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Test standard confirmation</span><span class="w">
</span><span class="nv">$testNodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="s2">"PC001"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PC002"</span><span class="p">)</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$testNodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$true</span><span class="w">

</span><span class="c"># Test auto-execute mode</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$testNodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># Test smart automation mode</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$testNodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="gui-testing">GUI Testing</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c"># Test GUI compatibility</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$testNodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w"> </span><span class="nt">-StatusCallback</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span><span class="w"> 
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"GUI Progress: </span><span class="si">$(</span><span class="nv">$status</span><span class="o">.</span><span class="nf">Activity</span><span class="si">)</span><span class="s2"> - </span><span class="si">$(</span><span class="nv">$status</span><span class="o">.</span><span class="nf">Status</span><span class="si">)</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Test data binding compatibility</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertTo-Json</span><span class="w"> </span><span class="nt">-Depth</span><span class="w"> </span><span class="nx">3</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="template-workflow-integration-testing">Template Workflow Integration Testing</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Test workflow integration (if applicable)</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"Your-Function"</span><span class="p">)</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$testNodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">

</span><span class="c"># Verify no double-prompting occurs</span><span class="w">
</span><span class="c"># Verify session-wide automation works correctly</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-enhanced-code-documentation-standards">üìù Enhanced Code Documentation Standards</h2>

<h3 id="comment-architecture-levels">Comment Architecture Levels</h3>

<h4 id="1-major-section-headers-80-character-width">1. Major Section Headers (80-character width)</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># ====================================================================</span><span class="w">
</span><span class="c"># ENHANCED CONFIRMATION PATTERN IMPLEMENTATION</span><span class="w">
</span><span class="c"># ====================================================================</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="2-subsection-headers-60-character-width">2. Subsection Headers (60-character width)</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c"># ========================================================</span><span class="w">
</span><span class="c"># SESSION-WIDE AUTOMATION STATE MANAGEMENT</span><span class="w">
</span><span class="c"># ========================================================</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="3-code-block-comments-explain-the-why">3. Code Block Comments (Explain the ‚ÄúWhy‚Äù)</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c"># Check for session-wide workflow automation preferences</span><span class="w">
</span><span class="c"># This prevents double-prompting when user selects "Yes to All"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w">
    </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Auto-proceeding (session-wide Yes to All)..."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="4-enhanced-confirmation-documentation">4. Enhanced Confirmation Documentation</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c"># Three-tier confirmation system for automation-friendly workflows:</span><span class="w">
</span><span class="c"># - $true: Standard confirmation (prompts every time)</span><span class="w">
</span><span class="c"># - $false: Auto-execute (no prompts, immediate execution)</span><span class="w">
</span><span class="c"># - "Auto": Smart automation (prompts once, remembers choice for session)</span><span class="w">

</span><span class="kr">switch</span><span class="w"> </span><span class="p">(</span><span class="nv">$confirm</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'^(YA|YESALL|YES.*ALL)$'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
        </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">
        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Will auto-proceed with all functions for this session."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Green</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="c"># ... other cases</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="variable-documentation-patterns">Variable Documentation Patterns</h3>

<h4 id="enhanced-confirmation-variables">Enhanced Confirmation Variables</h4>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Enhanced Confirmation State Management</span><span class="w">
</span><span class="nv">$shouldProceed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">                    </span><span class="c"># Execution gate for confirmation system</span><span class="w">
</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">         </span><span class="c"># Session-wide automation preferences</span><span class="w">
</span><span class="nv">$confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">                             </span><span class="c"># User input for confirmation prompts</span><span class="w">

</span><span class="c"># Template Workflow Integration</span><span class="w">
</span><span class="nv">$templateConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="w">                 </span><span class="c"># Inherited confirmation setting from workflow</span><span class="w">
</span><span class="nv">$executedTemplates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">                  </span><span class="c"># Successfully executed template names</span><span class="w">
</span><span class="nv">$workflowResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">                    </span><span class="c"># Template results for Excel export</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="Ô∏è-enhanced-module-structure--organization">üèóÔ∏è Enhanced Module Structure &amp; Organization</h2>

<h3 id="template-system-integration-1">Template System Integration</h3>

<p><strong>New Template-Related Regions:</strong></p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c">#region Template System &amp; Workflows</span><span class="w">
</span><span class="c"># Template command execution, workflow orchestration, template management</span><span class="w">
</span><span class="c"># Includes: Invoke-TemplateCommand, Invoke-TemplateWorkflow, Manage-Templates, Ensure-Templates</span><span class="w">
</span><span class="c">#endregion</span><span class="w">

</span><span class="c">#region Enhanced User Interaction</span><span class="w">
</span><span class="c"># Enhanced confirmation patterns, user preferences, automation support</span><span class="w">
</span><span class="c"># Includes: Enhanced confirmation implementation, session automation</span><span class="w">
</span><span class="c">#endregion</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="function-placement-guidelines">Function Placement Guidelines</h3>

<h4 id="where-to-put-new-functions">Where to Put New Functions</h4>
<ul>
  <li><strong>Template Functions</strong>: #region Template System &amp; Workflows</li>
  <li><strong>Enhanced Confirmation Functions</strong>: #region Enhanced User Interaction</li>
  <li><strong>Data Collection</strong>: #region Main Tools</li>
  <li><strong>Remote Management</strong>: #region Main Tools or #region Diagnostics</li>
  <li><strong>SCCM Integration</strong>: #region SCCM Functions</li>
  <li><strong>Reporting/Export</strong>: #region Logging or #region Excel Functions</li>
  <li><strong>Node Management</strong>: #region Node Management</li>
  <li><strong>Helper Functions</strong>: #region Utility Functions</li>
</ul>

<h4 id="enhanced-naming-conventions">Enhanced Naming Conventions</h4>
<ul>
  <li><strong>Template Functions</strong>: <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Invoke-Template*
</pre></td></tr></tbody></table></code>, <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Manage-Templates
</pre></td></tr></tbody></table></code></li>
  <li><strong>Workflow Functions</strong>: <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>*-Workflow
</pre></td></tr></tbody></table></code>, <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>*-TemplateWorkflow
</pre></td></tr></tbody></table></code></li>
  <li><strong>Enhanced Confirmation</strong>: Include <code class="language-plaintext highlighter-rouge"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>-Confirm
</pre></td></tr></tbody></table></code> parameter where appropriate</li>
  <li><strong>Verb-Noun</strong>: Follow PowerShell conventions</li>
  <li><strong>Get-</strong>: Data retrieval functions</li>
  <li><strong>Set-</strong>: Data modification functions</li>
  <li><strong>Test-</strong>: Validation/connectivity functions</li>
  <li><strong>Invoke-</strong>: Action/execution functions</li>
  <li><strong>New-</strong>: Object creation functions</li>
  <li><strong>Export-/Import-</strong>: Data transfer functions</li>
</ul>

<h2 id="-advanced-development-patterns">üí° Advanced Development Patterns</h2>

<h3 id="template-vs-function-decision-matrix">Template vs Function Decision Matrix</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Use Templates When:</span><span class="w">
</span><span class="c"># - Standard remote commands that can be reused</span><span class="w">
</span><span class="c"># - Testing procedures with manual/automated steps</span><span class="w">
</span><span class="c"># - Code patterns for development guidance</span><span class="w">
</span><span class="c"># - Operations that benefit from workflow orchestration</span><span class="w">

</span><span class="c"># Use Functions When:</span><span class="w">
</span><span class="c"># - Complex logic that can't be expressed in templates</span><span class="w">
</span><span class="c"># - Integration with CheckIT infrastructure (NodeList, CredStore, etc.)</span><span class="w">
</span><span class="c"># - Multi-step operations requiring state management</span><span class="w">
</span><span class="c"># - GUI integration requiring sophisticated data binding</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="enhanced-error-handling-pattern">Enhanced Error Handling Pattern</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c"># Session-aware error handling for template workflows</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="nv">$templateName</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="nv">$templateConfirm</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$result</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">CleanResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nv">$executedTemplates</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$templateName</span><span class="w">
        </span><span class="nv">$workflowResults</span><span class="p">[</span><span class="nv">$templateName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">.</span><span class="nf">CleanResults</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Template '</span><span class="nv">$templateName</span><span class="s2">' execution failed or returned no results."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$errorMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Template '</span><span class="nv">$templateName</span><span class="s2">' error: </span><span class="si">$(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Exception</span><span class="o">.</span><span class="nf">Message</span><span class="si">)</span><span class="s2">"</span><span class="w">
    </span><span class="n">Write-Color</span><span class="w"> </span><span class="nv">$errorMsg</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Red</span><span class="w">
    
    </span><span class="c"># Check if session-wide automation should continue or stop</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="o">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">WorkflowAutoConfirm</span><span class="p">[</span><span class="s1">'*'</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Continuing with remaining templates (session automation)..."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">Write-Color</span><span class="w"> </span><span class="s2">"Stopping workflow (session automation: No to All)."</span><span class="w"> </span><span class="nt">-Color</span><span class="w"> </span><span class="nx">Yellow</span><span class="w">
            </span><span class="kr">break</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="progressive-enhancement-pattern">Progressive Enhancement Pattern</h3>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c"># ‚úÖ CORRECT: Small, targeted enhancements</span><span class="w">
</span><span class="c"># Start with basic functionality, add enhanced confirmation later</span><span class="w">

</span><span class="c"># Version 1: Basic function</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Get-NodeInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="nv">$Nodes</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">)</span><span class="w">
    </span><span class="c"># Basic implementation</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Version 2: Add enhanced confirmation</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Get-NodeInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">param</span><span class="p">(</span><span class="nv">$Nodes</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">object</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$PromptUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">)</span><span class="w">
    </span><span class="c"># Add confirmation logic while preserving all existing functionality</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Version 3: Add template integration</span><span class="w">
</span><span class="c"># Move core logic to template, make function a wrapper</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Large refactors</span><span class="w">
</span><span class="c"># Rewriting entire function architecture</span><span class="w">
</span><span class="c"># Changing fundamental behavior</span><span class="w">
</span><span class="c"># Breaking existing integrations</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-comprehensive-testing--validation">üß™ Comprehensive Testing &amp; Validation</h2>

<h3 id="template-integration-testing">Template Integration Testing</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Test template command execution</span><span class="w">
</span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="p">@(</span><span class="s2">"PC001"</span><span class="p">)</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="s2">"Get OS Info"</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># Test template workflow with multiple templates</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="p">@(</span><span class="s2">"PC001"</span><span class="p">)</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"Get OS Info"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Check Disk Space"</span><span class="p">)</span><span class="w"> </span><span class="nt">-WorkflowName</span><span class="w"> </span><span class="s2">"Test"</span><span class="w"> </span><span class="nt">-ExportToExcel</span><span class="w">

</span><span class="c"># Test session automation</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"Get OS Info"</span><span class="p">)</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">
</span><span class="c"># Select "YA" (Yes to All)</span><span class="w">
</span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="s2">"Check Disk Space"</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">
</span><span class="c"># Should auto-proceed without prompting</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="enhanced-confirmation-testing">Enhanced Confirmation Testing</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c"># Test all confirmation modes</span><span class="w">
</span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$true</span><span class="w">    </span><span class="c"># Standard prompting</span><span class="w">
</span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$false</span><span class="w">   </span><span class="c"># Auto-execute</span><span class="w">
</span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">   </span><span class="c"># Smart automation</span><span class="w">

</span><span class="c"># Test session inheritance</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">  </span><span class="c"># Select "YA"</span><span class="w">
</span><span class="n">Your-Function</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">  </span><span class="c"># Should auto-proceed</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="regression-testing-checklist">Regression Testing Checklist</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="c"># After any enhancement, verify:</span><span class="w">

</span><span class="c"># 1. Original functionality still works</span><span class="w">
</span><span class="n">Get-Software</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Mode</span><span class="w"> </span><span class="nx">All</span><span class="w">

</span><span class="c"># 2. Enhanced functionality works  </span><span class="w">
</span><span class="n">Get-Software</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-Mode</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nt">-Confirm</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># 3. Template integration works</span><span class="w">
</span><span class="n">Invoke-TemplateWorkflow</span><span class="w"> </span><span class="nt">-Templates</span><span class="w"> </span><span class="p">@(</span><span class="s2">"List Installed Apps"</span><span class="p">)</span><span class="w"> </span><span class="nt">-Confirm</span><span class="w"> </span><span class="s2">"Auto"</span><span class="w">

</span><span class="c"># 4. Session automation works</span><span class="w">
</span><span class="c"># (Set session to "Yes to All", verify subsequent calls auto-proceed)</span><span class="w">

</span><span class="c"># 5. GUI compatibility maintained</span><span class="w">
</span><span class="nv">$results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Software</span><span class="w"> </span><span class="nt">-Nodes</span><span class="w"> </span><span class="nv">$nodes</span><span class="w"> </span><span class="nt">-PromptUser</span><span class="p">:</span><span class="bp">$false</span><span class="w">

</span><span class="c"># 6. Excel export still works</span><span class="w">
</span><span class="n">Export-ToExcel</span><span class="w"> </span><span class="nt">-InputObject</span><span class="w"> </span><span class="nv">$results</span><span class="w"> </span><span class="nt">-Title</span><span class="w"> </span><span class="s2">"Test"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="-development-anti-patterns-to-avoid">üìã Development Anti-Patterns to Avoid</h2>

<h3 id="-template-anti-patterns">‚ùå Template Anti-Patterns</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c"># ‚ùå WRONG: Building functions without checking templates first</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Get-SystemInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c"># Don't build this - use existing "Get OS Info" template</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Bypassing template workflows for multiple operations</span><span class="w">
</span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="s2">"Get OS Info"</span><span class="w">
</span><span class="n">Invoke-TemplateCommand</span><span class="w"> </span><span class="nt">-TemplateName</span><span class="w"> </span><span class="s2">"Check Disk Space"</span><span class="w">
</span><span class="c"># Use: Invoke-TemplateWorkflow -Templates @("Get OS Info", "Check Disk Space") -ExportToExcel</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Manual Excel sheet creation</span><span class="w">
</span><span class="nv">$sheets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{}</span><span class="w">
</span><span class="nv">$sheets</span><span class="p">[</span><span class="s2">"OSInfo"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$osResults</span><span class="w">
</span><span class="nv">$sheets</span><span class="p">[</span><span class="s2">"DiskInfo"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$diskResults</span><span class="w">
</span><span class="c"># Use: Template workflow with -ExportToExcel (handles sheet creation automatically)</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-confirmation-anti-patterns">‚ùå Confirmation Anti-Patterns</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c"># ‚ùå WRONG: Boolean-only confirmation</span><span class="w">
</span><span class="p">[</span><span class="n">bool</span><span class="p">]</span><span class="nv">$Confirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="w">

</span><span class="c"># ‚ùå WRONG: No session awareness</span><span class="w">
</span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"Proceed? (Y/N)"</span><span class="w">  </span><span class="c"># Asks every time, no automation</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Inconsistent confirmation inheritance</span><span class="w">
</span><span class="c"># Workflow sets automation, but individual functions ignore it</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="-integration-anti-patterns">‚ùå Integration Anti-Patterns</h3>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># ‚ùå WRONG: Direct global manipulation</span><span class="w">
</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">nodeList</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$newNode</span><span class="w">
</span><span class="nv">$</span><span class="nn">global</span><span class="p">:</span><span class="nv">Reports</span><span class="p">[</span><span class="s1">'Reports'</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nv">$result</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Mixed reporting concerns</span><span class="w">
</span><span class="n">Set-Report</span><span class="w"> </span><span class="nt">-Task</span><span class="w"> </span><span class="nt">-TaskParams</span><span class="w"> </span><span class="p">@{</span><span class="err">...</span><span class="p">}</span><span class="w">  </span><span class="c"># Causes double reporting</span><span class="w">

</span><span class="c"># ‚ùå WRONG: Manual credential handling in new functions</span><span class="w">
</span><span class="nv">$cred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Credential</span><span class="w">  </span><span class="c"># Use Process-Parallel -UseCredentials</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<p>üìñ <strong>Documentation Index</strong></p>
<ul>
  <li><a href="/CheckIT-Documentation/archive/assistance-guide.html">AI Assistant Guide</a> - AI-specific development guidelines and collaboration patterns</li>
  <li><a href="/CheckIT-Documentation/archive/api-reference.html">API Reference</a> - Complete function library with enhanced template system</li>
  <li><a href="/CheckIT-Documentation/archive/troubleshooting.html">Troubleshooting</a> - Technical solutions and anti-patterns</li>
  <li><a href="/CheckIT-Documentation/archive/implementation-status.html">Implementation Status</a> - Current completion status including template system</li>
  <li><a href="../README.md">Main README</a> - Project overview and quick start</li>
</ul>

<table>
  <tbody>
    <tr>
      <td><strong>Last Updated</strong>: 2025-06-09</td>
      <td><strong>Enhanced</strong>: Template workflow system and enhanced confirmation patterns</td>
    </tr>
  </tbody>
</table>

<hr />

      </div>
    </main>
  </div>

  <script src="/CheckIT-Documentation/assets/js/code-blocks.js"></script>
  <script src="/CheckIT-Documentation/assets/js/function-links.js"></script>
  <script src="/CheckIT-Documentation/assets/js/field-icons.js"></script>
  <script src="/CheckIT-Documentation/assets/js/functionCardTabs.js"></script>  
</body>
</html>